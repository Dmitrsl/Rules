# Rules of Machine Learning: Best Practices for ML Engineering
#### Google https://developers.google.com/machine-learning/guides/rules-of-ml/

Этот документ предназначен для того, чтобы помочь тем, кто обладает базовыми знаниями в области машинного обучения, воспользоваться преимуществами лучших практик Google в области машинного обучения. Он представляет стиль для машинного обучения, похожий на Google C ++ Style Guide и другие популярные руководства по практическому программированию. Если вы прошли курс обучения по машинному обучению, или построили или работали над моделью с машинным обучением, у вас есть необходимые знания для прочтения этого документа.

## Terminology

The following terms will come up repeatedly in our discussion of effective machine learning:

### Instance:
вещь, о которой вы хотите сделать прогноз. Например, экземпляром может быть веб-страница, которую вы хотите классифицировать как «о кошках» или «не о кошках».
### Label:
ответ на задачу прогнозирования: либо ответ, полученный с помощью системы машинного обучения, либо правильный ответ, содержащийся в данных обучения. Например, ярлык для веб-страницы может быть «о кошках».
### Feature:
свойство экземпляра, используемого в задаче прогнозирования. Например, веб-страница может иметь функцию «содержит слово «кошка»»
### Feature Column:
набор связанных функций, например набор всех возможных стран, в которых могут жить пользователи. Пример может иметь одну или несколько функций, присутствующих в столбце функций. «Столбец функций» - это специфическая для Google терминология. Функциональный столбец упоминается как «пространство имен» в системе VW (в Yahoo / Microsoft) или поле.
### Example:
экземпляр (с его функциями) и метка.
### Model:
статистическое представление задачи прогнозирования. Вы тренируете модель на примерах, а затем используете модель для прогнозирования.
### Metric:
число, которое вам небезразлично. Может или не может быть напрямую оптимизировано.
### Objective:
показатель, который ваш алгоритм пытается оптимизировать.
### Pipeline:
инфраструктура, окружающая алгоритм машинного обучения. Включает сбор данных из внешнего интерфейса, размещение их в файлах данных обучения, обучение одной или нескольким моделям и экспорт моделей в производство.
### Click-through Rate:
Процент посетителей веб-страницы, которые нажимают на ссылку в объявлении.

## Overview

Чтобы сделать отличные продукты:

### делайте машинное обучение, как великий инженер, а не великий специалист по машинному обучению, которым вы не являетесь.

Большинство проблем, с которыми вы столкнетесь, на самом деле являются инженерными проблемами. Даже при наличии всех ресурсов великого специалиста по машинному обучению большая часть выигрыша достигается за счет великолепных функций, а не великолепных алгоритмов машинного обучения. Итак, основной подход:

Убедитесь, что ваш pipline сплошной от начала до конца.
Начните с разумной цели.
Добавить функции здравого смысла простым способом.
Убедитесь, что ваш pipeline остается целостным.
Этот подход будет хорошо работать в течение длительного периода времени. Отходите от этого подхода только тогда, когда нет более простых трюков, чтобы продвинуться дальше. Добавление сложности замедляет будущие выпуски.

После того, как вы исчерпали простые уловки, передовое машинное обучение действительно может быть в вашем будущем. См. Раздел «Проекты машинного обучения III фазы».

Этот документ организован следующим образом:

Первая часть должна помочь вам понять, настало ли время для построения системы машинного обучения.
Вторая часть о развертывании вашего первого конвейера.
Третья часть посвящена запуску и итерации при добавлении новых функций в конвейер, оценке моделей и перекосам в обучении.
Заключительная часть о том, что делать, когда вы достигаете плато.
После этого приведен список связанных работ и приложение с некоторыми сведениями о системах, которые обычно используются в качестве примеров в этом документе.

## Before Machine Learning

### Правило № 1: не бойтесь запускать продукт без машинного обучения.
Машинное обучение это круто, но для этого нужны данные. Теоретически, вы можете взять данные из другой проблемы, а затем настроить модель для нового продукта, но это, вероятно, приведет к снижению базовой эвристики. Если вы думаете, что машинное обучение даст вам 100% прирост, то эвристика даст вам 50% пути.

Например, если вы ранжируете приложения на рынке приложений, вы можете использовать скорость или количество установок в качестве эвристики. Если вы обнаруживаете спам, отфильтруйте издателей, которые ранее отправляли спам. Не бойтесь использовать человеческое редактирование. Если вам нужно ранжировать контакты, ранжируйте последний использованный наивысший (или даже ранжируйте в алфавитном порядке). Если машинное обучение не является абсолютно необходимым для вашего продукта, не используйте его, пока у вас нет данных.

### Правило № 2: во-первых, проектируйте и внедряйте метрики.
Прежде чем формализовать, что будет делать ваша система машинного обучения, отследите как можно больше в вашей текущей системе. Сделайте это по следующим причинам:

Проще получить разрешение от пользователей системы раньше.
Если вы думаете, что что-то может стать проблемой в будущем, лучше получить исторические данные сейчас.
Если вы разрабатываете свою систему с учетом метрической измерительной аппаратуры, в будущем у вас все будет лучше. В частности, вы не хотите, чтобы вы пытались найти строки в журналах для измерения ваших показателей!
Вы заметите, что меняется, а что остается неизменным. Например, предположим, что вы хотите напрямую оптимизировать однодневных активных пользователей. Тем не менее, во время ваших ранних манипуляций с системой вы можете заметить, что существенные изменения в пользовательском интерфейсе заметно не изменяют этот показатель.
Показатели команды Google Plus увеличиваются за чтение, повторные публикации за чтение, добавочные скидки за чтение, комментарии / чтение, комментарии за пользователя, повторные публикации за пользователя и т. Д., Которые они используют для вычисления качества поста во время обслуживания. Также обратите внимание, что структура эксперимента, в которой вы можете группировать пользователей в сегменты и агрегировать статистику по эксперименту, важна. См. Правило № 12.

Будучи более либеральным в отношении сбора метрик, вы можете получить более широкое представление о вашей системе. Заметили проблему? Добавьте метрику, чтобы отслеживать это! В восторге от каких-то количественных изменений в последнем выпуске? Добавьте метрику, чтобы отслеживать это!

### Правило № 3: Выбирайте машинное обучение вместо сложной эвристики.
Простая эвристика может вывести ваш продукт за дверь. Сложная эвристика не поддерживается. Когда у вас есть данные и базовое представление о том, чего вы пытаетесь достичь, переходите к машинному обучению. Как и в большинстве задач разработки программного обеспечения, вам нужно постоянно обновлять свой подход, будь то эвристическая или машинно-обучаемая модель, и вы обнаружите, что машинно-обучаемую модель легче обновлять и поддерживать (см. Правило № 16). ).

## ML Phase I: Your First Pipeline

Сосредоточьтесь на вашей системной инфраструктуры для вашего первого конвейера. В то время как интересно думать обо всем творческом машинном обучении, которое вы собираетесь делать, будет трудно понять, что происходит, если вы сначала не доверяете своему конвейеру.

### Правило № 4: оставьте первую модель простой и получите правильную инфраструктуру.
Первая модель обеспечивает самый мощный импульс вашему продукту, поэтому она не должна быть модной. Но вы столкнетесь с гораздо большим количеством проблем с инфраструктурой, чем ожидаете. Прежде чем кто-либо сможет использовать вашу новую систему машинного обучения, вы должны определить:

Как получить примеры для вашего алгоритма обучения.
Первое замечание относительно того, что «хорошо» и «плохо» означает для вашей системы.
Как интегрировать вашу модель в ваше приложение. Вы можете применить модель в реальном времени или предварительно рассчитать модель на примерах в автономном режиме и сохранить результаты в таблице. Например, вы можете предварительно классифицировать веб-страницы и сохранять результаты в таблице, но вы можете классифицировать сообщения чата в режиме реального времени.
Выбор простых функций облегчает обеспечение того, что:

Функции достигают вашего алгоритма обучения правильно.
Модель узнает разумные веса.
Функции достигают вашей модели на сервере правильно.
Когда у вас есть система, которая выполняет эти три вещи надежно, вы сделали большую часть работы. Ваша простая модель предоставляет вам базовые метрики и базовое поведение, которые вы можете использовать для тестирования более сложных моделей. Некоторые команды стремятся к «нейтральному» первому запуску: первому запуску, который явно лишает приоритетов результаты машинного обучения, чтобы не отвлекаться.

### Правило № 5: Тестируйте инфраструктуру независимо от машинного обучения.
Убедитесь, что инфраструктура тестируема, и что обучающие части системы инкапсулированы, чтобы вы могли протестировать все вокруг. В частности:

Проверьте получение данных в алгоритм. Убедитесь, что столбцы объектов, которые должны быть заполнены, заполнены. Там, где позволяет конфиденциальность, вручную проверьте входные данные вашего алгоритма обучения. Если возможно, проверьте статистику в своем конвейере по сравнению со статистикой для тех же данных, которые обрабатываются в другом месте.
Тестирование получения моделей из алгоритма обучения. Убедитесь, что модель в вашей учебной среде дает ту же оценку, что и модель в вашей рабочей среде (см. Правило № 37).
Машинное обучение имеет элемент непредсказуемости, поэтому убедитесь, что у вас есть тесты для кода для создания примеров в обучении и обслуживании, и что вы можете загружать и использовать фиксированную модель во время обслуживания. Также важно понимать ваши данные: см. Практические советы по анализу больших, сложных наборов данных.

### Правило № 6: Будьте осторожны с пропущенными данными при копировании конвейеров.
Часто мы создаем конвейер, копируя существующий конвейер (т.е. программирование культа груза), и старый конвейер отбрасывает данные, которые нам нужны для нового конвейера. Например, конвейер для Google Plus Whats Hot отбрасывает старые сообщения (потому что он пытается ранжировать свежие сообщения). Этот конвейер был скопирован для использования в Google Plus Stream, где старые посты все еще имеют смысл, но конвейер все еще отбрасывал старые посты. Другой распространенный способ - регистрировать только те данные, которые видел пользователь. Таким образом, эти данные бесполезны, если мы хотим смоделировать, почему конкретный пост не был просмотрен пользователем, потому что все отрицательные примеры были отброшены. Подобная проблема произошла в Play. Во время работы над Play Apps Home был создан новый конвейер, который также содержал примеры с целевой страницы Play Games без какой-либо функции, позволяющей определить, откуда взялся каждый пример.

### Правило № 7: превращайте эвристику в функции или обрабатывайте их внешне.
Обычно проблемы, которые пытается решить машинное обучение, не новы. Существует существующая система ранжирования, классификации или любой другой проблемы, которую вы пытаетесь решить. Это значит, что есть куча правил и эвристик. Эта же эвристика может поднять вас, когда вы настраиваете машинное обучение. Ваша эвристика должна быть добыта для любой информации, которую они имеют, по двум причинам. Во-первых, переход к системе машинного обучения будет более плавным. Во-вторых, обычно эти правила содержат много интуиции о системе, которую вы не хотите отбрасывать. Существует четыре способа использования существующей эвристики:

Препроцесс с использованием эвристики. Если функция невероятно крутая, то это вариант. Например, если в спам-фильтре отправитель уже занесен в черный список, не пытайтесь повторно узнать, что означает «черный список». Заблокируйте сообщение. Этот подход наиболее целесообразен в задачах двоичной классификации.
Создать функцию. Непосредственное создание функции из эвристики - это здорово. Например, если вы используете эвристику для вычисления оценки релевантности для результата запроса, вы можете включить оценку в качестве значения функции. Позже вы можете захотеть использовать методы машинного обучения для массирования значения (например, преобразования значения в одно из конечного набора дискретных значений или объединения его с другими функциями), но начните с использования необработанного значения, созданного эвристикой.
Шахта сырых входов эвристики. Если для приложений существует эвристика, которая сочетает в себе количество установок, количество символов в тексте и день недели, то подумайте о том, чтобы разделить эти части на части и подать эти входные данные в обучение по отдельности. Некоторые приемы, применимые к ансамблям, применимы здесь (см. Правило № 40).
Изменить ярлык. Это вариант, когда вы чувствуете, что эвристика захватывает информацию, которая в данный момент не содержится в метке. Например, если вы пытаетесь максимизировать количество загрузок, но вам также нужен качественный контент, то, возможно, решение состоит в том, чтобы умножить метку на среднее количество звездочек, полученных приложением. Здесь много возможностей. Смотрите «Ваша первая цель».
Помните о дополнительной сложности при использовании эвристики в системе ML. Использование старой эвристики в вашем новом алгоритме машинного обучения может помочь в создании плавного перехода, но подумайте, есть ли более простой способ добиться того же эффекта.

## мониторинг

В общем, соблюдайте правила гигиены предупреждений, например, активируйте оповещения и создайте страницу панели мониторинга.

### Правило № 8: Знайте требования свежести вашей системы.
Насколько снижается производительность, если у вас есть модель, которая старше одного дня? Неделю назад? Четверть года? Эта информация может помочь вам понять приоритеты вашего мониторинга. Если вы теряете значительное качество продукции, если модель не обновляется в течение дня, имеет смысл, чтобы инженер постоянно следил за ней. Большинство систем показа рекламы имеют новые рекламные объявления, которые нужно обрабатывать каждый день, и должны обновляться ежедневно. Например, если модель ML для поиска в Google Play не обновлена, это может оказать негативное влияние менее чем через месяц. Некоторые модели для Whats Hot в Google Plus не имеют идентификатора поста в своей модели, поэтому они могут экспортировать эти модели нечасто. Другие модели, имеющие почтовые идентификаторы, обновляются гораздо чаще. Также обратите внимание, что свежесть может меняться со временем, особенно, когда столбцы объектов добавляются или удаляются из вашей модели.

### Правило № 9: Обнаружение проблем перед экспортом моделей.
Многие системы машинного обучения имеют этап, на котором вы экспортируете модель в обслуживание. Если существует проблема с экспортированной моделью, это проблема, с которой сталкиваются пользователи.

Сделайте проверку работоспособности прямо перед экспортом модели. В частности, убедитесь, что производительность модели является разумной на удерживаемых данных. Или, если у вас есть проблемы с данными, не экспортируйте модель. Многие команды, постоянно внедряющие модели, проверяют область под кривой ROC (или AUC) перед экспортом. Проблемы с моделями, которые не были экспортированы, требуют оповещения по электронной почте, но проблемы с пользовательской моделью могут требовать страницы. Так что лучше подождать и быть уверенным, прежде чем повлиять на пользователей.

### Правило № 10: следите за тихими неудачами.
Эта проблема чаще встречается в системах машинного обучения, чем в других системах. Предположим, что конкретная таблица, к которой присоединяются, больше не обновляется. Система машинного обучения отрегулируется, и поведение продолжит оставаться достаточно хорошим, постепенно ухудшаясь. Иногда вы находите таблицы, которые устарели на месяцы, и простое обновление повышает производительность больше, чем любой другой запуск в этом квартале! Охват функции может измениться из-за изменений реализации: например, столбец функции может быть заполнен в 90% примеров и внезапно упасть до 60% примеров. Однажды у Play был стол, который устарел на 6 месяцев, а обновление только одного стола увеличило скорость установки на 2%. Если вы отслеживаете статистику данных, а также вручную проверяете их, вы можете уменьшить количество таких сбоев.

### Правило № 11: Дайте владельцам колонок и документацию.
Если система большая и в ней имеется много столбцов элементов, узнайте, кто создал или поддерживает каждый столбец элементов. Если вы обнаружите, что человек, который понимает колонку функций, уходит, убедитесь, что у кого-то есть информация. Хотя многие столбцы функций имеют описательные имена, полезно иметь более подробное описание того, что это за функция, откуда она взялась и как она должна помочь.

## Ваша первая цель

У вас есть много метрик или измерений для системы, которая вас интересует, но ваш алгоритм машинного обучения часто требует единственной цели - числа, которое ваш алгоритм «пытается» оптимизировать. Здесь я различаю цели и метрики: метрика - это любое число, которое сообщает ваша система, что может быть или не быть важным. Смотрите также Правило № 2.

### Правило № 12: не задумывайтесь над тем, какую цель вы хотите оптимизировать напрямую.
Вы хотите зарабатывать деньги, радовать своих пользователей и делать мир лучше. Есть множество метрик, которые вас интересуют, и вы должны измерить их все (см. Правило № 2). Однако на ранних этапах процесса машинного обучения вы заметите, что все они повышаются, даже те, которые вы не оптимизировали напрямую. Например, предположим, что вы заботитесь о количестве кликов и времени, проведенном на сайте. Если вы оптимизируете количество кликов, вы, вероятно, увидите увеличение затраченного времени.

Так что будьте проще и не думайте слишком сильно о балансировке различных метрик, когда вы все еще можете легко увеличить все метрики. Однако не следует слишком далеко заходить к этому правилу: не путайте свою цель с конечным состоянием системы (см. Правило № 39). И, если вы обнаружите, что увеличиваете непосредственно оптимизированную метрику, но решили не запускать, может потребоваться некоторая объективная ревизия.

### Правило № 13: Выберите простую, наблюдаемую и атрибутивную метрику для своей первой цели.
Часто вы не знаете, какова истинная цель. Вы так думаете, но затем, взглянув на данные и проведя параллельный анализ вашей старой системы и новой системы ML, вы понимаете, что хотите изменить цель. Кроме того, разные члены команды часто не могут договориться об истинной цели. Целью ОД должно быть что-то, что легко измерить и является доверенным лицом для «истинной» цели. На самом деле, зачастую нет «истинной» цели (см. Правило № 39). Так что потренируйтесь на простой цели ML и подумайте о том, чтобы иметь «верхний уровень политики», который позволит вам добавить дополнительную логику (надеюсь, очень простую логику) для окончательного ранжирования.

Проще всего смоделировать поведение пользователя, которое непосредственно наблюдается и связано с действием системы:

Была ли нажата эта ранжированная ссылка?
Этот ранжированный объект был загружен?
Был ли этот оцененный объект переслан / отправлен / отправлен по электронной почте?
Был ли этот оцененный объект оценен?
Был ли это показано объект помечается как спам / порнография / наступление?
Сначала избегайте моделирования косвенных эффектов:

Посетил ли пользователь на следующий день?
Как долго пользователь посещал сайт?
Какими были ежедневные активные пользователи?
Косвенные эффекты дают отличные показатели и могут использоваться во время A / B-тестирования и при принятии решения о запуске.

Наконец, не пытайтесь заставить машинное обучение выяснить:

Доволен ли пользователь этим продуктом?
Удовлетворен ли пользователь опытом?
Улучшает ли продукт общее самочувствие пользователя?
Как это повлияет на общее состояние здоровья компании?
Все это важно, но также невероятно сложно измерить. Вместо этого используйте прокси: если пользователь доволен, он останется на сайте дольше. Если пользователь удовлетворен, он посетит снова завтра. Если речь идет о благосостоянии и здоровье компании, человеческое суждение необходимо для связи любой изученной машины с характером продукта, который вы продаете, и вашим бизнес-планом.

### Правило № 14: начало с интерпретируемой модели облегчает отладку.
Линейная регрессия, логистическая регрессия и регрессия Пуассона напрямую мотивируются вероятностной моделью. Каждый прогноз интерпретируется как вероятность или ожидаемое значение. Это облегчает их отладку по сравнению с моделями, в которых используются цели (потеря ноль один, различные потери шарнира и т. Д.), Которые пытаются напрямую оптимизировать точность классификации или эффективность ранжирования. Например, если вероятности в обучении отклоняются от вероятностей, предсказанных параллельно или при проверке производственной системы, это отклонение может выявить проблему.

Например, в линейной, логистической или пуассоновской регрессии существуют подмножества данных, где среднее прогнозируемое ожидание равно средней метке (калибровка по одному моменту или только калибровка). Это верно, если предположить, что у вас нет регуляризации и что ваш алгоритм сходится, и это примерно верно в целом. Если у вас есть особенность, которая равна 1 или 0 для каждого примера, тогда откалиброван набор из 3 примеров, где эта особенность равна 1. Кроме того, если у вас есть особенность, равная 1 для каждого примера, тогда набор всех примеров откалиброван.

С простыми моделями легче иметь дело с петлями обратной связи (см. Правило № 36). Часто мы используем эти вероятностные прогнозы для принятия решения: например, ранжировать сообщения по убыванию ожидаемого значения (то есть вероятность клика / загрузки / и т. д.). Однако помните, когда приходит время выбирать, какую модель использовать, решение имеет большее значение, чем вероятность получения данных данной модели (см. Правило № 27).

### Правило № 15: Отдельная фильтрация спама и ранжирование качества на уровне политики.
Оценка качества - это искусство, а фильтрация спама - война. Сигналы, которые вы используете для определения сообщений высокого качества, станут очевидными для тех, кто использует вашу систему, и они настроят свои сообщения, чтобы иметь эти свойства. Таким образом, ваш качественный рейтинг должен быть ориентирован на рейтинг контента, который публикуется добросовестно. Вы не должны сбрасывать со счетов качества ученика рейтинга для ранжирования спама высоко. Аналогичным образом, «нестандартный» контент должен обрабатываться отдельно от рейтинга качества. Фильтрация спама - это отдельная история. Вы должны ожидать, что функции, которые вам нужны, будут постоянно меняться. Часто в систему вводятся очевидные правила (если у поста более трех голосов за спам, не извлекайте его и т. Д.). Любая изученная модель должна обновляться ежедневно, если не быстрее. Репутация создателя контента сыграет большую роль.

На некотором уровне выходные данные этих двух систем должны быть интегрированы. Имейте в виду, что фильтрация спама в результатах поиска, вероятно, должна быть более агрессивной, чем фильтрация спама в сообщениях электронной почты. Это верно, если предположить, что у вас нет регуляризации и что ваш алгоритм сходится. Это примерно верно в целом. Кроме того, стандартной практикой является удаление спама из данных обучения для классификатора качества.

## ML Phase II: Feature Engineering

На первом этапе жизненного цикла системы машинного обучения важными вопросами являются передача данных обучения в систему обучения, инструментирование любых интересующих метрик и создание обслуживающей инфраструктуры.
### После того, как у вас есть работающая сквозная система с инструментальными и системными тестами, начинается фаза II.

На втором этапе много низко висящих фруктов. Существует множество очевидных особенностей, которые могут быть задействованы в системе. Таким образом, вторая фаза машинного обучения включает в себя использование максимально возможного количества функций и их интуитивное сочетание. На этом этапе все показатели должны расти. Будет много запусков, и это прекрасное время для привлечения большого количества инженеров, которые могут объединить все данные, необходимые для создания действительно потрясающей системы обучения.

### Правило № 16: Планируйте запуск и повторение.
Не ожидайте, что модель, над которой вы работаете сейчас, станет последней, которую вы запустите, или даже когда вы прекратите запуск моделей. Таким образом, подумайте, замедлит ли сложность, которую вы добавляете с этим запуском в будущем. Многие команды запускают модель на квартал или более в течение многих лет. Есть три основных причины для запуска новых моделей:

Вы придумываете новые функции.
Вы настраиваете регуляризацию и комбинируете старые функции новыми способами.
Вы настраиваете цель.
В любом случае, подарить модели немного любви - это хорошо: просмотр данных, поступающих в пример, может помочь найти как новые сигналы, так и старые, сломанные. Поэтому, когда вы строите свою модель, подумайте о том, как легко добавлять, удалять или объединять функции. Подумайте о том, как легко создать свежую копию конвейера и проверить ее правильность. Подумайте, возможно ли иметь две или три копии, работающие параллельно. Наконец, не беспокойтесь о том, попадет ли функция 16 из 35 в эту версию конвейера. Вы получите это в следующем квартале.

### Правило № 17: Начните с непосредственно наблюдаемых и сообщаемых особенностей в отличие от изученных особенностей.
Это может быть спорным моментом, но это позволяет избежать многих подводных камней. Прежде всего, давайте опишем, что такое изученная особенность. Изученный признак - это признак, сгенерированный либо внешней системой (такой как неконтролируемая система кластеризации), либо самим учеником (например, с помощью факторизованной модели или глубокого обучения). Оба из них могут быть полезны, но они могут иметь много проблем, поэтому они не должны быть в первой модели.

Если вы используете внешнюю систему для создания функции, помните, что внешняя система имеет свою цель. Задача внешней системы может быть слабо коррелирована с вашей текущей целью. Если вы сделаете снимок внешней системы, он может устареть. Если вы обновите функции из внешней системы, то значения могут измениться. Если вы используете внешнюю систему для предоставления функции, помните, что этот подход требует особого внимания.

Основная проблема с факторизованными моделями и глубокими моделями заключается в том, что они невыпуклые. Таким образом, нет никакой гарантии, что оптимальное решение может быть аппроксимировано или найдено, а локальные минимумы, найденные на каждой итерации, могут быть разными. Это изменение затрудняет оценку того, является ли влияние изменений в вашей системе значительным или случайным. Создавая модель без глубоких функций, вы можете получить отличную базовую производительность. После того, как этот базовый уровень достигнут, вы можете попробовать более эзотерические подходы.

### Правило № 18: Изучите особенности контента, которые обобщаются в разных контекстах.
Зачастую система машинного обучения является небольшой частью гораздо более широкой картины. Например, если вы представляете сообщение, которое может использоваться в журнале «Что нового?», Многие люди добавят один, поделятся им или прокомментируют сообщение до того, как оно будет показано в разделе «Что нового». Если вы предоставляете эту статистику учащемуся, он может продвигать новые сообщения, для которых у него нет данных, в контексте, который он оптимизирует. YouTube Watch Next может использовать количество просмотров или совместного просмотра (подсчет количества просмотров одного видео после просмотра другого) из поиска YouTube. Вы также можете использовать явные пользовательские рейтинги. Наконец, если у вас есть пользовательское действие, которое вы используете в качестве метки, просмотр этого действия в документе в другом контексте может быть отличной возможностью. Все эти функции позволяют вам вносить новый контент в контекст. Обратите внимание, что это не относится к персонализации: сначала выясните, нравится ли кому-то контент в этом контексте, а затем выясните, кому он нравится больше или меньше.

### Правило № 19: Используйте очень специфические функции, когда можете.
Благодаря огромному количеству данных проще изучить миллионы простых функций, чем несколько сложных функций. Идентификаторы извлекаемых документов и канонизированные запросы не дают большого обобщения, но выстраивают ваш рейтинг в соответствии с вашими метками в заголовочных запросах. Таким образом, не бойтесь групп функций, где каждая функция применяется к очень небольшой части ваших данных, но общий охват превышает 90%. Вы можете использовать регуляризацию, чтобы исключить функции, которые применяются к слишком немногим примерам.

### Правило № 20. Объединяйте и изменяйте существующие функции, чтобы создавать новые функции понятными для человека способами.
Существует множество способов комбинирования и изменения функций. Системы машинного обучения, такие как TensorFlow, позволяют предварительно обрабатывать данные с помощью преобразований. Двумя наиболее стандартными подходами являются «дискретизация» и «крестики».

Дискретизация заключается в получении непрерывного элемента и создании из него множества отдельных элементов. Рассмотрим непрерывную функцию, такую ​​как возраст. Вы можете создать функцию, которая равна 1, если возраст меньше 18 лет, еще одна функция, которая равна 1, если возраст составляет от 18 до 35 лет, и так далее. Не переусердствуйте с границами этих гистограмм: основные квантили дадут вам большую часть воздействия.

Кресты объединяют два или более столбцов объектов. Столбец объектов в терминологии TensorFlow представляет собой набор однородных элементов (например, {мужчина, женщина}, {США, Канада, Мексика} и так далее). Крест - это новый столбец объектов с элементами, например, {мужчина, женщина} × {США, Канада, Мексика}. Этот новый столбец функции будет содержать функцию (мужчина, Канада). Если вы используете TensorFlow и говорите TensorFlow создать этот крест для вас, эта функция (мужчина, Канада) будет присутствовать в примерах, представляющих канадцев-мужчин. Обратите внимание, что для изучения моделей с крестами из трех, четырех или более столбцов базовых объектов требуются огромные объемы данных.

Кресты, которые создают очень большие столбцы объектов, могут переопределиться. Например, представьте, что вы выполняете какой-то поиск, у вас есть столбец объектов со словами в запросе, и у вас есть столбец объектов со словами в документе. Вы можете комбинировать их с крестиком, но в итоге вы получите множество функций (см. Правило № 21).

При работе с текстом есть две альтернативы. Самый драконовский - точечный продукт. Точечный продукт в его простейшей форме просто подсчитывает количество слов, общих для запроса и документа. Эта функция может быть затем дискретизирована. Другой подход - пересечение: таким образом, у нас будет особенность, которая присутствует тогда и только тогда, когда слово «пони» присутствует и в документе, и в запросе, и другая особенность, которая присутствует тогда и только тогда, когда слово «the» является как в документе, так и в запросе.

### Правило № 21: количество весов элементов, которые вы можете узнать в линейной модели, приблизительно пропорционально количеству данных, которые у вас есть.
Существуют захватывающие статистические результаты теории обучения, касающиеся соответствующего уровня сложности для модели, но это правило - в основном все, что вам нужно знать. У меня были разговоры, в которых люди сомневались, что чему-нибудь научиться можно из тысячи примеров, или что вам когда-нибудь понадобится более миллиона примеров, потому что они застряли в определенном методе обучения. Ключом является масштабирование вашего обучения в соответствии с размером ваших данных:

Если вы работаете в системе ранжирования поиска, и в документах и ​​запросе содержатся миллионы различных слов, и у вас есть 1000 помеченных примеров, то вам следует использовать точечный продукт между функциями документа и запроса, TF-IDF и половину. -дюжина других высокотехнологичных функций. 1000 примеров, десяток функций.
Если у вас есть миллион примеров, пересекайте столбцы объектов документа и запросов, используя регуляризацию и, возможно, выбор объектов. Это даст вам миллионы функций, но с регуляризацией у вас будет меньше. Десять миллионов примеров, может быть, сто тысяч функций.
Если у вас есть миллиарды или сотни миллиардов примеров, вы можете пересечь столбцы объектов с токенами документов и запросов, используя выбор функций и регуляризацию. У вас будет миллиард примеров и 10 миллионов функций. Теория статистического обучения редко дает жесткие границы, но дает отличные ориентиры для отправной точки.
В конце используйте правило № 28, чтобы решить, какие функции использовать.

### Правило № 22: Очистите функции, которые вы больше не используете.
Неиспользованные функции создают технический долг. Если вы обнаружите, что не используете функцию, и что объединение ее с другими функциями не работает, удалите ее из своей инфраструктуры. Вы хотите поддерживать свою инфраструктуру в чистоте, чтобы наиболее перспективные функции можно было использовать как можно быстрее. При необходимости кто-то всегда может добавить обратно вашу функцию.

Имейте в виду покрытие при рассмотрении, какие функции добавить или сохранить. Сколько примеров охвачено этой функцией? Например, если у вас есть некоторые функции персонализации, но только 8% ваших пользователей имеют какие-либо функции персонализации, это не будет очень эффективным.

В то же время некоторые функции могут прыгать выше их веса. Например, если у вас есть функция, которая охватывает только 1% данных, но 90% примеров, которые имеют функцию, являются положительными, то это будет отличная возможность для добавления.

Человеческий анализ системы
Прежде чем перейти к третьему этапу машинного обучения, важно сосредоточиться на том, чему не учат ни в одном классе машинного обучения: как взглянуть на существующую модель и улучшить ее. Это скорее искусство, чем наука, и все же есть несколько антипаттернов, которых он помогает избежать.

### Правило № 23: Вы не типичный конечный пользователь.
Это, пожалуй, самый простой способ для команды увязнуть. В то время как есть много преимуществ в кормлении рыб (использование прототипа в вашей команде) и собачьем кормлении (использование прототипа в вашей компании), сотрудники должны посмотреть, правильна ли производительность. В то время как изменения, которые явно плохие, не должны использоваться, все, что выглядит разумно рядом с производством, должно подвергаться дальнейшему тестированию, либо платя непрофессионалам за ответы на вопросы на краудсорсинговой платформе, либо посредством живого эксперимента с реальными пользователями.

Для этого есть две причины. Во-первых, вы слишком близки к коду. Возможно, вы ищете определенный аспект постов или просто слишком эмоционально вовлечены (например, уклон подтверждения). Во-вторых, ваше время слишком ценно. Рассмотрите стоимость девяти инженеров, сидящих на одном часовом совещании, и подумайте о том, сколько контрактных человеческих ярлыков покупается на краудсорсинговой платформе.

Если вы действительно хотите получать отзывы пользователей, используйте методики взаимодействия с пользователем. Создайте личность пользователя (одно описание приведено в разделе «Зарисовка пользовательского опыта» Билла Бакстона) на раннем этапе процесса, а затем выполните тестирование удобства использования (одно описание приведено в статье Стива Круга «Не заставляй меня думать»). Персонажи пользователя предполагают создание гипотетического пользователя. Например, если ваша команда состоит из мужчин, это может помочь спроектировать 35-летнюю женщину-пользователя (в комплекте с пользовательскими функциями) и посмотреть на результаты, которые она генерирует, а не на 10 результатов для детей от 25 до 40 лет. мужчины. Привлечение реальных людей для наблюдения за их реакцией на ваш сайт (локально или удаленно) в тестировании юзабилити также может дать вам новую перспективу.

### Правило № 24: измеряйте дельту между моделями.
Одним из самых простых и иногда наиболее полезных измерений, которые вы можете выполнить, прежде чем пользователи увидят вашу новую модель, является расчет того, насколько новые результаты отличаются от результатов производства. Например, если у вас есть проблема ранжирования, запустите обе модели на выборке запросов по всей системе и посмотрите на размер симметричной разности результатов (взвешенный по ранжированию). Если разница очень мала, без эксперимента вы можете сказать, что изменений не будет. Если разница очень большая, то вы хотите убедиться, что изменение хорошее. Просматривая запросы с высокой симметричной разницей, вы сможете качественно понять, на что было похоже это изменение. Однако убедитесь, что система стабильна. Убедитесь, что модель по сравнению с самой собой имеет низкую (в идеале нулевую) симметричную разность.

### Правило № 25: При выборе моделей утилитарная производительность превосходит предсказательную силу.
Ваша модель может попытаться предсказать рейтинг кликов. Однако, в конце концов, ключевым вопросом является то, что вы делаете с этим прогнозом. Если вы используете его для ранжирования документов, то качество окончательного ранжирования имеет большее значение, чем сам прогноз. Если вы прогнозируете вероятность того, что документ является спамом, а затем урежете то, что заблокировано, то точность того, что разрешено просматривать, имеет большее значение. В большинстве случаев эти две вещи должны быть согласованы: когда они не согласны, это, скорее всего, принесет небольшую выгоду. Таким образом, если есть какое-то изменение, которое улучшает потерю журнала, но ухудшает производительность системы, ищите другую функцию. Когда это начинает происходить чаще, наступает время пересмотреть цель вашей модели.

### Правило № 26: ищите закономерности в измеренных ошибках и создавайте новые функции.
Предположим, вы видите тренировочный пример, в котором модель «ошиблась». В задаче классификации эта ошибка может быть ложноположительной или ложноотрицательной. В задании ранжирования ошибкой может быть пара, в которой положительный рейтинг ранжирован ниже отрицательного. Наиболее важным моментом является то, что это пример того, что система машинного обучения знает, что она ошиблась, и хотела бы исправить ее, если бы была возможность. Если вы предоставите модели функцию, позволяющую исправить ошибку, модель попытается использовать ее.

С другой стороны, если вы попытаетесь создать функцию на основе примеров, которые система не считает ошибочными, эта функция будет проигнорирована. Например, предположим, что в Play Apps Search кто-то ищет «бесплатные игры». Предположим, что одним из лучших результатов является менее актуальное приложение для gag. Таким образом, вы создаете функцию для «gag apps». Однако, если вы максимизируете количество установок, и люди устанавливают gag-приложение, когда ищут бесплатные игры, функция «gag-apps» не даст желаемого эффекта.

Если у вас есть примеры, что модель ошиблась, ищите тренды, которые находятся за пределами вашего текущего набора функций. Например, если система, кажется, удаляет более длинные сообщения, добавьте длину сообщения. Не будьте слишком конкретны в отношении функций, которые вы добавляете. Если вы собираетесь добавить длину поста, не пытайтесь угадать, что значит длинный, просто добавьте дюжину функций и позвольте модели выяснить, что с ними делать (см. Правило № 21). Это самый простой способ получить то, что вы хотите.

### Правило № 27: Старайтесь количественно оценить наблюдаемое нежелательное поведение.
Некоторые члены вашей команды начнут разочаровываться в свойствах системы, которые им не нравятся и не учитываются существующей функцией потерь. На этом этапе они должны сделать все возможное, чтобы превратить свои жалобы в сплошные числа. Например, если они думают, что в Play Search отображается слишком много «gag-приложений», они могут заставить людей опознавать gag-приложения. (В этом случае вы можете реально использовать данные, помеченные людьми, потому что относительно небольшая часть запросов составляет большую часть трафика.) Если ваши проблемы поддаются измерению, вы можете начать использовать их в качестве функций, целей или показателей. Общее правило: «Измеряй первым, оптимизируй вторым».

### Правило № 28: Помните, что идентичное краткосрочное поведение не подразумевает идентичное долгосрочное поведение.
Представьте, что у вас есть новая система, которая просматривает каждый doc_id и correct_query, а затем вычисляет вероятность клика для каждого документа для каждого запроса. Вы обнаружите, что его поведение практически идентично вашей текущей системе в обеих сторонах и A / B-тестировании, поэтому, учитывая ее простоту, вы запускаете ее. Однако вы заметили, что новые приложения не отображаются. Зачем? Итак, поскольку ваша система показывает документ только на основе своей истории с этим запросом, нет способа узнать, что новый документ должен отображаться.

Единственный способ понять, как такая система будет работать в долгосрочной перспективе, - это обучить ее только тем данным, которые были получены, когда модель работала. Это очень сложно.

## Training-Serving Skew

Перекос при обучении - это разница между эффективностью во время тренировки и эффективностью во время подачи. Этот перекос может быть вызван:

Несоответствие между тем, как вы обрабатываете данные в обучающем и обслуживающем конвейерах.
Изменение в данных между тем, когда вы тренируетесь и когда вы служите.
Цикл обратной связи между вашей моделью и вашим алгоритмом.
Мы наблюдали за производственными системами машинного обучения в Google с перекосом в обучении, который негативно влияет на производительность. Лучшее решение - это явный мониторинг, чтобы изменения в системе и данных не вносили перекос незамеченным.

### Правило № 29: Лучший способ убедиться, что вы тренируетесь так, как вы служите, - это сохранить набор функций, используемых во время обслуживания, а затем передать эти функции в журнал, чтобы использовать их во время обучения.
Даже если вы не можете сделать это для каждого примера, сделайте это за небольшую часть, чтобы вы могли проверить соответствие между подачей и обучением (см. Правило № 37). Команды, которые сделали это измерение в Google, иногда были удивлены результатами. Домашняя страница YouTube переключилась на функции ведения журналов во время обслуживания со значительным улучшением качества и уменьшением сложности кода, и многие команды переключают свою инфраструктуру, как мы говорим.

### Правило № 30: выборочные данные с весом важности, не выбрасывайте их произвольно!
Если у вас слишком много данных, возникает искушение взять файлы 1-12 и игнорировать файлы 13-99. Это ошибка. Хотя данные, которые никогда не показывались пользователю, могут быть отброшены, взвешивание важности лучше для остальных. Весовой коэффициент значимости означает, что, если вы решите, что собираетесь использовать пример X с вероятностью 30%, присвойте ему вес 10/3. С учетом важности все свойства калибровки, обсуждаемые в правиле № 14, остаются в силе.

### Правило № 31: Помните, что если вы объединяете данные из таблицы во время тренировки и обслуживания, данные в таблице могут измениться.
Допустим, вы объединяете идентификаторы документов с таблицей, содержащей функции для этих документов (например, количество комментариев или кликов). Между тренировкой и обслуживанием, функции в таблице могут быть изменены. Предсказание вашей модели для одного и того же документа может различаться в зависимости от обучения и обслуживания. Самый простой способ избежать подобных проблем - регистрировать функции во время обслуживания (см. Правило № 32). Если таблица изменяется медленно, вы также можете делать снимки таблицы ежечасно или ежедневно, чтобы получить достаточно близкие данные. Обратите внимание, что это все еще не полностью решает проблему.

### Правило №32. Повторно используйте код между тренировочным конвейером и обслуживающим конвейером, когда это возможно.
Пакетная обработка отличается от онлайн-обработки. При онлайн-обработке вы должны обрабатывать каждый запрос по мере его поступления (например, вы должны выполнять отдельный поиск для каждого запроса), тогда как при пакетной обработке вы можете комбинировать задачи (например, делать соединение). Во время обслуживания вы выполняете онлайн-обработку, а обучение - это задача пакетной обработки. Однако есть некоторые вещи, которые вы можете сделать, чтобы повторно использовать код. Например, вы можете создать объект, специфичный для вашей системы, в котором результаты любых запросов или объединений могут быть сохранены очень удобным для восприятия человеком способом, и ошибки могут быть легко проверены. Затем, как только вы соберете всю информацию, во время обслуживания или обучения, вы запускаете общий метод для связи между читаемым человеком объектом, который специфичен для вашей системы, и любым форматом, который ожидает система машинного обучения. Это исключает источник перекоса при обучении. Как следствие, старайтесь не использовать два разных языка программирования между обучением и обслуживанием. Это решение сделает практически невозможным обмен кода.

### Правило № 33: Если вы производите модель на основе данных до 5 января, протестируйте модель на данных с 6 января и после.
В общем, измеряйте производительность модели по данным, собранным после данных, на которых вы обучили модель, так как это лучше отражает то, что ваша система будет делать в производстве. Если вы создадите модель на основе данных до 5 января, протестируйте модель на данных с 6 января. Вы ожидаете, что на новых данных производительность будет не такой хорошей, но она не должна быть радикально хуже. Поскольку могут быть ежедневные эффекты, вы не можете предсказать среднюю частоту кликов или коэффициент конверсии, но область под кривой, которая представляет вероятность того, что положительный пример получит оценку выше, чем отрицательный, должна быть достаточно близкой.

### Правило № 34. В двоичной классификации для фильтрации (такой как обнаружение спама или определение интересных электронных писем) делайте небольшие кратковременные потери в производительности для очень чистых данных.
В задаче фильтрации примеры, помеченные как отрицательные, не показываются пользователю. Предположим, у вас есть фильтр, который блокирует 75% отрицательных примеров при подаче. У вас может возникнуть соблазн получить дополнительные данные обучения из экземпляров, показанных пользователям. Например, если пользователь помечает письмо как спам, которое пропускает ваш фильтр, вы можете извлечь из этого урок.

Но этот подход вводит смещение выборки. Вы можете собирать более чистые данные, если вместо этого во время обслуживания вы помечаете 1% всего трафика как «задержанный», и отправляете все разрозненные примеры пользователю. Теперь ваш фильтр блокирует не менее 74% негативных примеров. Эти протяженные примеры могут стать вашими тренировочными данными.

Обратите внимание, что если ваш фильтр блокирует 95% или более отрицательных примеров, этот подход становится менее жизнеспособным. Тем не менее, если вы хотите измерить эффективность подачи, вы можете сделать еще более мелкую выборку (скажем, 0,1% или 0,001%). Десять тысяч примеров достаточно, чтобы оценить производительность достаточно точно.

### Правило № 35: Остерегайтесь присущих проблем в ранжировании.
Когда вы достаточно радикально переключаете свой алгоритм ранжирования, чтобы отображались разные результаты, вы эффективно изменили данные, которые ваш алгоритм увидит в будущем. Этот вид перекоса появится, и вы должны создать свою модель вокруг него. Есть несколько разных подходов. Эти подходы - все способы одобрить данные, которые ваша модель уже видела.

Повышенная регуляризация функций, охватывающих больше запросов, в отличие от функций, включенных только для одного запроса. Таким образом, модель будет отдавать предпочтение функциям, характерным для одного или нескольких запросов, по сравнению с функциями, которые обобщаются для всех запросов. Такой подход может помочь предотвратить попадание очень популярных результатов в нерелевантные запросы. Обратите внимание, что это противоречит более общепринятому совету иметь больше регуляризации для столбцов объектов с более уникальными значениями.
Разрешить только функции иметь положительные веса. Таким образом, любая хорошая функция будет лучше, чем функция, которая является «неизвестной».
Не имеют функции только для документов. Это экстремальная версия № 1. Например, даже если данное приложение является популярной загрузкой независимо от того, какой был запрос, вы не хотите показывать его везде. Отсутствие функций только для документов делает это простым. Причина, по которой вы не хотите показывать какое-либо конкретное популярное приложение, связана с важностью обеспечения доступности всех желаемых приложений. Например, если кто-то ищет «приложение для наблюдения за птицами», он может загрузить «злые птицы», но это определенно не было их целью. Отображение такого приложения может повысить скорость загрузки, но в конечном итоге не удовлетворит потребности пользователя.

### Правило № 36. Избегайте петель обратной связи с позиционными функциями.
Положение контента существенно влияет на вероятность взаимодействия пользователя с ним. Если вы поставите приложение на первую позицию, оно будет щелкаться чаще, и вы будете уверены, что оно будет чаще нажиматься. Один из способов справиться с этим - добавить позиционные функции, то есть функции, касающиеся положения контента на странице. Вы тренируете свою модель с позиционными особенностями, и она учится весить, например, функцию «1-е положение». Таким образом, ваша модель придает меньшее значение другим факторам для примеров с «1stposition = true». Тогда при обслуживании вы не предоставляете ни одному экземпляру позиционную функцию, или вы предоставляете им одну и ту же функцию по умолчанию, потому что вы оцениваете кандидатов до того, как определились с порядком их отображения.

Обратите внимание, что важно держать какие-либо позиционные элементы несколько отделенными от остальной части модели из-за этой асимметрии между обучением и тестированием. Если модель будет суммой функции позиционных характеристик, а функция остальных функций является идеальной. Например, не пересекайте позиционные элементы с какими-либо документами.

### Правило № 37: Измерьте тренировку / служение.
Есть несколько вещей, которые могут вызвать перекос в самом общем смысле. Более того, вы можете разделить его на несколько частей:

Разница между показателями тренировочных данных и данными удержания. В общем, так будет всегда, и это не всегда плохо.
Разница между производительностью на данных удержания и данными «на следующий день». Опять же, это всегда будет существовать. Вы должны настроить свою регуляризацию, чтобы максимизировать производительность на следующий день. Тем не менее, значительное падение производительности между данными о задержке и данных следующего дня может указывать на то, что некоторые функции чувствительны ко времени и, возможно, снижают производительность модели.
Разница между производительностью данных «на следующий день» и данных в реальном времени. Если вы применяете модель к примеру в обучающих данных и к тому же примеру на службе, она должна дать вам точно такой же результат (см. Правило № 5). Таким образом, расхождение здесь, вероятно, указывает на техническую ошибку.

## ML Phase III: Slowed Growth, Optimization Refinement, and Complex Models

Будут определенные признаки того, что второй этап подходит к концу. Прежде всего, ваши ежемесячные прибыли начнут уменьшаться. У вас начнутся компромиссы между метриками: вы увидите, что некоторые растут, а другие падают в некоторых экспериментах. Вот где это становится интересным. Поскольку достижения труднее достичь, машинное обучение должно стать более сложным. Предупреждение: в этом разделе больше правил голубого неба, чем в предыдущих разделах. Мы видели, как многие команды прошли через счастливые времена машинного обучения Фазы I и Фазы II. Как только фаза III достигнута, команды должны найти свой собственный путь.

### Правило № 38. Не тратьте время на новые функции, если проблема связана с невыровненными целями.
По мере того как ваше плато измерений начнет работать, ваша команда начнет изучать проблемы, выходящие за рамки задач вашей нынешней системы машинного обучения. Как указывалось ранее, если цели продукта не охватываются существующей алгоритмической задачей, вам необходимо изменить либо свою цель, либо цели своего продукта. Например, вы можете оптимизировать клики, плюсы или загрузки, но принимать решения о запуске, основываясь частично на людях.

### Правило № 39. Решения о выпуске являются прокси для долгосрочных целей продукта.
У Алисы есть идея по снижению логистических потерь при прогнозировании установок. Она добавляет особенность. Логистический убыток падает. Когда она делает живой эксперимент, она видит увеличение скорости установки. Однако, когда она идет на встречу по обзору запуска, кто-то указывает, что количество ежедневно активных пользователей падает на 5%. Команда решает не запускать модель. Алиса разочарована, но теперь понимает, что решения о запуске зависят от нескольких критериев, только некоторые из которых могут быть непосредственно оптимизированы с помощью ML.

Правда в том, что реальный мир - это не подземелья и драконы: нет «хит-поинтов», определяющих здоровье вашего продукта. Команда должна использовать собранную статистику, чтобы попытаться эффективно предсказать, насколько хорошей будет система в будущем. Им нужно позаботиться о вовлеченности, 1-дневном количестве активных пользователей (DAU), 30 DAU, доходах и окупаемости инвестиций рекламодателя. Эти показатели, которые можно измерить в тестах A / B сами по себе, являются лишь прокси для более долгосрочных целей: удовлетворение пользователей, увеличение пользователей, удовлетворение партнеров и получение прибыли, которые даже в этом случае можно рассматривать как прокси для получения полезного, высококачественного продукта и процветающая компания через пять лет.

Единственное легкое решение о запуске - это когда все показатели улучшаются (или, по крайней мере, не ухудшаются). Если у команды есть выбор между сложным алгоритмом машинного обучения и простой эвристикой, если простая эвристика лучше справляется со всеми этими метриками, она должна выбрать эвристику. Более того, нет явного ранжирования всех возможных значений метрики. В частности, рассмотрим следующие два сценария:

Ежедневный Эксперимент Активных Пользователей Доход / День
1 миллион 4 миллиона долларов
B 2 миллиона $ 2 миллиона
Если текущая система A, то команда вряд ли переключится на B. Если текущая система B, то команда вряд ли переключится на A. Это, кажется, противоречит рациональному поведению; однако прогнозы изменения метрик могут или не могут быть успешными, и, таким образом, существует большой риск, связанный с любым изменением. Каждая метрика покрывает некоторый риск, которым занимается команда.

Более того, ни одна метрика не покрывает основной заботы команды: «Где мой продукт будет через пять лет»?

С другой стороны, люди склонны отдавать предпочтение одной цели, которую они могут напрямую оптимизировать. Большинство инструментов машинного обучения предпочитают такую ​​среду. Инженер, предлагающий новые функции, может получить постоянный поток запусков в такой среде. Существует тип машинного обучения, многоцелевое обучение, которое начинает решать эту проблему. Например, можно сформулировать проблему удовлетворения ограничений, которая имеет более низкие оценки для каждой метрики и оптимизирует некоторую линейную комбинацию метрик. Однако даже в этом случае не все метрики легко обозначаются как цели машинного обучения: если на документ нажимают или приложение установлено, то это потому, что контент был показан. Но гораздо сложнее понять, почему пользователь посещает ваш сайт. Как предсказать будущий успех сайта в целом, зависит от ИИ: так же сложно, как компьютерное зрение или обработка естественного языка.

### Правило № 40: Делайте ансамбли простыми.
Унифицированные модели, которые используют необработанные функции и напрямую ранжируют контент, являются простейшими моделями для отладки и понимания. Тем не менее, ансамбль моделей («модель», которая сочетает в себе множество других моделей) может работать лучше. Для простоты каждая модель должна быть либо ансамблем, принимающим только вклад других моделей, либо базовой моделью, принимающей множество функций, но не обе. Если у вас есть модели поверх других моделей, которые обучаются отдельно, то комбинирование их может привести к плохому поведению.

Используйте простую модель для ансамбля, которая принимает только выходные данные ваших «базовых» моделей в качестве входных данных. Вы также хотите применить свойства в этих моделях ансамблей. Например, увеличение оценки, произведенной базовой моделью, не должно уменьшать оценку ансамбля. Кроме того, лучше всего, если входящие модели семантически интерпретируются (например, откалиброваны), чтобы изменения базовых моделей не смешивали ансамблевую модель. Кроме того, убедитесь, что увеличение прогнозируемой вероятности базового классификатора не уменьшает прогнозируемую вероятность ансамбля.

### Правило № 41: Когда плато производительности, ищите качественно новые источники информации для добавления, а не уточнения существующих сигналов.
Вы добавили демографическую информацию о пользователе. Вы добавили некоторую информацию о словах в документе. Вы прошли исследование шаблонов и настроили регуляризацию. Вы не видели запуска с более чем 1% улучшением ваших ключевых показателей за несколько кварталов. Что теперь?

Пришло время приступить к созданию инфраструктуры для радикально различных функций, таких как история документов, к которым этот пользователь обращался за последний день, неделю или год, или данные из другого свойства. Используйте объекты вики-данных или что-то внутреннее для вашей компании (например, график знаний Google). Используйте глубокое обучение. Начните корректировать свои ожидания относительно того, какую отдачу вы ожидаете от инвестиций, и соответственно расширяйте свои усилия. Как и в любом инженерном проекте, вы должны взвесить выгоду от добавления новых функций против стоимости повышенной сложности.

### Правило № 42. Не ожидайте, что разнообразие, персонализация или релевантность будут коррелировать с популярностью так, как вы думаете.
Разнообразие в наборе контента может означать много вещей, причем разнообразие источника контента является одним из наиболее распространенных. Персонализация подразумевает, что каждый пользователь получает свои собственные результаты. Релевантность подразумевает, что результаты для определенного запроса являются более подходящими для этого запроса, чем для любого другого. Таким образом, все три из этих свойств определены как отличающиеся от обычных.

Проблема в том, что обычного, как правило, трудно победить.

Обратите внимание, что если ваша система измеряет количество кликов, затраченное время, количество часов, +1, количество повторных обращений и т. Д., Вы измеряете популярность контента. Команды иногда пытаются выучить личную модель с разнообразием. Для персонализации они добавляют функции, которые позволяют системе персонализировать (некоторые функции, представляющие интересы пользователя) или диверсифицировать (функции, указывающие, имеет ли этот документ какие-либо общие черты с другими возвращенными документами, такими как автор или контент), и обнаруживают, что функции получают меньший вес (или иногда другой знак), чем они ожидают.

Это не означает, что разнообразие, персонализация или актуальность не являются ценными. Как указано в предыдущем правиле, вы можете выполнить постобработку, чтобы увеличить разнообразие или релевантность. Если вы видите, что долгосрочные цели растут, вы можете заявить, что разнообразие / актуальность важна, помимо популярности. Затем вы можете либо продолжать использовать постобработку, либо напрямую изменить цель, основываясь на разнообразии или релевантности.

### Правило № 43: Ваши друзья, как правило, одинаковы для разных продуктов. Ваши интересы, как правило, не таковы.
Команды в Google получили большую тягу от принятия модели, предсказывающей близость соединения в одном продукте, и от того, что она хорошо работает на другом. Твои друзья такие, какие они есть. С другой стороны, я наблюдал, как несколько команд боролись с особенностями персонализации в разных продуктах. Да, похоже, это должно работать. На данный момент, похоже, нет. Иногда сработало использование необработанных данных из одного свойства для прогнозирования поведения другого. Также имейте в виду, что даже знание того, что у пользователя есть история в другом свойстве, может помочь. Например, наличие активности пользователя в двух продуктах может быть само по себе показательным.

## Related Work
Есть много документов по машинному обучению как в Google, так и за его пределами.

Crash Course машинного обучения: введение в прикладное машинное обучение.
Машинное обучение: вероятностный подход Кевина Мерфи для понимания области машинного обучения.
Практические советы по анализу больших, сложных наборов данных: наукоемкий подход к размышлению о наборах данных.
Глубокое обучение Яна Гудфеллоу и др. Для изучения нелинейных моделей.
Документ Google о технических долгах, в котором есть много общих советов.
Tensorflow Документация.
Подтверждения
Благодарю Дэвида Уэстбрука, Питера Брандта, Самуэля Ионга, Ченю Чжао, Ли Вэя, Михалиса Потамиаса, Эвана Розена, Барри Розенберга, Кристин Робсон, Джеймса Пина, Тала Шакеда, Тушара Чандру, Мустафу Испира, Иеремию Хармсена, Константиноса Кациапонса, Гена Дэн Дакворт, Шишир Бирмивал, Гал Элидан, Су Лин Ву, Джайхуэй Лю, Фернандо Перейра и Хришикеш Арадхье за ​​множество исправлений, предложений и полезных примеров для этого документа. Также спасибо Кристен Лефевр, Суддха Басу и Крис Берг, которые помогли с более ранней версией. Любые ошибки, упущения или (удушье!) Непопулярные мнения - мои собственные.

## аппендикс
В этом документе есть множество ссылок на продукты Google. Чтобы обеспечить больше контекста, я приведу краткое описание наиболее распространенных примеров ниже.

## Обзор YouTube
YouTube - это сервис потокового видео. Обе команды YouTube Watch Next и YouTube Home Page используют модели ML для ранжирования видео рекомендаций. «Watch Next» рекомендует смотреть видео после текущего воспроизводимого, а «Домашняя страница» рекомендует видео пользователям, просматривающим домашнюю страницу.

## Обзор Google Play
В Google Play есть множество моделей, решающих самые разные задачи. Play Search, персональные рекомендации Play Home Page и приложения «Пользователи также установлены» используют машинное обучение.

## Обзор Google Plus
Google Plus использует машинное обучение в различных ситуациях: ранжирование постов в «потоке» постов, просматриваемых пользователем, ранжирование постов «Что нового» (посты, которые сейчас очень популярны), ранжирование людей, которых вы знаете, и так далее.

